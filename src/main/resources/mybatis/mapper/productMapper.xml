<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 
<mapper namespace="product">
	<insert id="insertProduct" parameterType="productRequest">
		insert into product(category,product_name,product_price,product_value,product_date,product_rating,product_unit,product_delivery,product_exchange,product_as,manager_id) 
		values(#{categoryCode},#{product_name},#{product_price},#{product_value},sysdate(),0,#{product_unit},#{product_delivery},#{product_exchange},#{product_as},#{manager_id})
	</insert>
  
	<insert id="insertProductImage" parameterType="productImageRequest">
		insert into product_image(pro_img_id,product_id,pro_img_name,pro_img_server,pro_filesize,manager_id)
		values(#{pro_img_id},#{product_id},#{pro_img_name},#{pro_img_server},#{pro_filesize},#{manager_id});
	</insert>
	
	<select id="getProductId" parameterType="productRequest" resultType="int">
		select product_id from product where product_name = #{product_name} and manager_id = #{manager_id}
	</select>

	<select id="getManageProductList" parameterType="String" resultType="manageProductDTO">
		select a.product_id, a.product_name, a.category, a.product_price, a.product_sales_stat,b.pro_img_server
		from product a,product_image b 
		where a.product_Id = b.product_id and 
		a.manager_id = #{id} and 
		pro_img_name Like '%thumb____' order by a.product_id*1 desc;
	</select>
	
	<delete id="deleteProduct" parameterType="list">
		delete from product where 
		<foreach collection="list" item="item" index="index" separator="or">
		product_id = #{item}
		</foreach>
	</delete>
	
	<delete id="deleteProductImage" parameterType="list">
		delete from product_image where 
		<foreach collection="list" item="item" index="index" separator="or">
		product_id = #{item}
		</foreach>
	</delete>
	
	<select id="getProductImageName" parameterType="list" resultType="String">
		select pro_img_name from product_image where
		<foreach collection="list" item="item" index="index" separator="or">
		product_id = #{item}
		</foreach> 
	</select>
	
	<select id="searchProduct" resultType="manageProductDTO">
		SELECT product_id, category, product_name, product_value, product_rating
		FROM product
		<include refid="search"></include>
	</select>
	
	<sql id="search">
		WHERE product_id LIKE CONCAT('%', #{keyword},'%') OR product_name LIKE CONCAT('%', #{keyword}, '%') 
	</sql>
</mapper>
